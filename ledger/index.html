<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>EchoprintOS • Capture</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{background:#0b0c10;color:#e8eaed;font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0}
    .wrap{width:min(820px,92vw);margin:0 auto;padding:28px 0 80px}
    a{color:#8ab4f8}
    .nav{display:flex;gap:22px;padding:8px 0 18px}
    .card{background:#121419;border:1px solid #1f232b;border-radius:18px;padding:26px}
    h1{margin:8px 0 4px}
    .drop{border:1px dashed #2a2f3a;border-radius:12px;padding:26px;text-align:center;color:#a7b0bc}
    .btn{appearance:none;border:1px solid #1e2a22;background:#18d0a8;color:#04261f;border-radius:10px;height:42px;padding:0 16px;font-weight:700;cursor:pointer}
    .ghost{background:#10141a;color:#cdd3da;border:1px solid #222834}
    pre{background:#0f1116;border:1px solid #232a38;border-radius:12px;padding:14px;overflow:auto}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="nav"><a href="/">← Ledger</a> <span style="opacity:.6">Capture</span></div>
    <div class="card">
      <h1>Capture</h1>
      <p>Drop a file or pick one. We’ll compute a <b>SHA-256</b> (64-hex) locally.</p>

      <div class="drop" id="drop">
        <input id="file" type="file" style="display:none">
        <button class="btn ghost" onclick="document.getElementById('file').click()">Choose file…</button>
        <div id="picked" style="margin-top:8px;opacity:.8">No file selected.</div>
      </div>

      <div id="out" style="margin-top:18px;display:none">
        <div><b>Hash</b></div>
        <div class="mono" id="hash" style="margin:6px 0 10px"></div>
        <div class="mono" id="ecp"></div>
        <div style="display:flex;gap:10px;margin-top:12px">
          <button class="btn" onclick="copy('#hash')">Copy hash</button>
          <button class="btn ghost" onclick="copy('#json')">Copy JSON</button>
        </div>
        <div style="margin-top:14px"><b>Payload</b></div>
        <pre id="json" class="mono">{}</pre>
      </div>
    </div>
  </div>

<script>
const $ = s=>document.querySelector(s);
const fileEl = $('#file');
fileEl.addEventListener('change', handle);

async function handle(){
  const f = fileEl.files[0];
  if(!f){ $('#picked').textContent='No file selected.'; return; }
  $('#picked').textContent = `${f.name} (${(f.size/1024).toFixed(1)} KB)`;
  const buf = await f.arrayBuffer();
  const hashHex = await sha256hex(buf);
  const ts = new Date().toISOString();
  const ecp = 'ECP-' + ts.replace(/\D/g,'').slice(0,14); // simple client ECP
  $('#hash').textContent = hashHex;
  $('#ecp').textContent  = `Record ID: ${ecp}`;
  $('#json').textContent = JSON.stringify({ record_id: ecp, title: f.name, hash: hashHex, timestamp_iso: ts }, null, 2);
  $('#out').style.display='block';
}
async function sha256hex(buf){
  const h = await crypto.subtle.digest('SHA-256', buf);
  const bytes = Array.from(new Uint8Array(h));
  return bytes.map(b => b.toString(16).padStart(2,'0')).join('');
}
async function copy(sel){
  const t = $(sel).textContent;
  try{ await navigator.clipboard.writeText(t); }catch{}
}
</script>
</body>
</html>
