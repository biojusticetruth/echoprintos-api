<!doctype html>
<meta charset="utf-8">
<title>EchoprintOS REST ping</title>
<button id="go">Insert test row</button>
<pre id="out" style="white-space:pre-wrap"></pre>
<script>
  const SUPABASE_URL = 'https://cyndhzyfaffprdebclnw.supabase.co/rest/v1/echoprints?on_conflict=url&select=*';
  const ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5bmRoenlmYWZmcHJkZWJjbG53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0OTQxNDUsImV4cCI6MjA3NzA3MDE0NX0.DynJLTGOKDlvLPy_W5jThsWYANens2yGKzY8am6XD6c'; // remove this file after testing

  document.getElementById('go').onclick = async () => {
    const url = `${SUPABASE_URL}/rest/v1/echoprints?on_conflict=url&select=record_id,title,url,platform,created_at`;
    const payload = {
      record_id: `ECP-${Date.now()}-${crypto.randomUUID().slice(0,8)}`,
      title: 'Zap test ping',
      url: 'https://example.com/zap-test',
      platform: 'Substack',
      is_test: false
    };
    const r = await fetch(url, {
      method: 'POST',
      headers: {
        apikey: ANON,
        Authorization: `Bearer ${ANON}`,
        'Content-Type': 'application/json',
        Prefer: 'resolution=merge-duplicates,return=representation'
      },
      body: JSON.stringify(payload)
    });
    const body = await r.json().catch(()=> ({}));
    document.getElementById('out').textContent =
      `${r.status} ${r.statusText}\n` + JSON.stringify(body, null, 2);
  };
</script>
